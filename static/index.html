<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Спортивная команда</title>
    <style>
        :root {
            --bg: #f4f7fb;
            --card-bg: #ffffff;
            --accent: #7cc6ff;
            --accent-soft: #d6efff;
            --text-main: #333333;
            --text-muted: #777777;
            --border: #dde3ee;
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background: linear-gradient(135deg, #f4f7fb 0%, #e3f1ff 40%, #fdf7ff 100%);
            color: var(--text-main);
        }

        .wrapper {
            max-width: 960px;
            margin: 30px auto;
            padding: 0 16px;
        }

        .card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 20px 24px 24px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.04);
            border: 1px solid rgba(255, 255, 255, 0.7);
        }

        h1 {
            text-align: center;
            margin-top: 0;
            margin-bottom: 4px;
            font-size: 24px;
            letter-spacing: 0.04em;
            text-transform: uppercase;
        }

        .subtitle {
            text-align: center;
            font-size: 13px;
            color: var(--text-muted);
            margin-bottom: 18px;
        }

        .header-line {
            display: flex;
            flex-wrap: wrap;
            gap: 12px;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 14px;
        }

        .search-block {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            align-items: center;
        }

        .search-block label {
            font-size: 13px;
            color: var(--text-muted);
        }

        .search-input {
            padding: 8px 10px;
            border-radius: 999px;
            border: 1px solid var(--border);
            min-width: 230px;
            font-size: 14px;
            outline: none;
            background-color: #f9fbff;
        }

        .search-input:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 2px rgba(124, 198, 255, 0.3);
            background-color: #ffffff;
        }

        .btn {
            border-radius: 999px;
            border: none;
            padding: 8px 16px;
            font-size: 14px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: linear-gradient(135deg, #7cc6ff, #9be7ff);
            color: #0b213a;
            font-weight: 500;
            box-shadow: 0 6px 14px rgba(124, 198, 255, 0.4);
            transition: transform 0.08s ease, box-shadow 0.08s ease, opacity 0.08s ease;
        }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 8px 18px rgba(124, 198, 255, 0.5);
        }

        .btn:active {
            transform: translateY(0);
            box-shadow: 0 4px 10px rgba(124, 198, 255, 0.35);
            opacity: 0.95;
        }

        #error {
            color: #c0392b;
            font-size: 13px;
            margin-bottom: 4px;
            min-height: 16px;
        }

        #info {
            color: var(--text-muted);
            font-size: 12px;
            margin-bottom: 8px;
        }

        table {
            border-collapse: collapse;
            width: 100%;
            margin-top: 8px;
            font-size: 14px;
        }

        th, td {
            padding: 8px 10px;
            text-align: left;
        }

        th {
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 0.06em;
            color: var(--text-muted);
            border-bottom: 1px solid var(--border);
            background: #f7faff;
        }

        tr:nth-child(even) td {
            background-color: #fafbff;
        }

        tr:hover td {
            background-color: #eef5ff;
        }

        td {
            border-bottom: 1px solid #f0f3fb;
        }

        .col-id {
            width: 40px;
            text-align: center;
        }

        .col-name {
            width: 35%;
        }

        .col-city {
            width: 25%;
        }

        .col-height, .col-weight {
            width: 12%;
            text-align: center;
        }

        .empty-row td {
            text-align: center;
            color: var(--text-muted);
            font-style: italic;
        }

        @media (max-width: 700px) {
            .header-line {
                align-items: flex-start;
            }
            .search-input {
                min-width: 180px;
                width: 100%;
            }
            table {
                font-size: 13px;
            }
            th, td {
                padding: 6px 8px;
            }
        }
    </style>
</head>
<body>
<div class="wrapper">
    <div class="card">
        <div class="header-line">
            <div>
                <h1>Спортивная команда</h1>
                <div class="subtitle">Просмотр и поиск игроков по базе данных</div>
            </div>
        </div>

        <div class="search-block">
            <label for="searchInput">Поиск по ФИО или городу:</label>
            <input id="searchInput"
                   class="search-input"
                   type="text"
                   placeholder="например, Иванов или Москва">
            <button id="searchBtn" class="btn">
                Найти
            </button>
            <button id="resetBtn" class="btn" style="background: #e4f4ff; box-shadow: none; color:#2b4a66;">
                ⟳ Сброс
            </button>
        </div>

        <div id="error"></div>
        <div id="info"></div>

        <table id="playersTable">
            <thead>
            <tr>
                <th class="col-id">ID</th>
                <th class="col-name">ФИО</th>
                <th class="col-city">Город</th>
                <th class="col-height">Рост, см</th>
                <th class="col-weight">Вес, кг</th>
            </tr>
            </thead>
            <tbody>
            <!-- строки будут подставлены скриптом -->
            </tbody>
        </table>
    </div>
</div>

<script>
    async function loadPlayers(query = "") {
        const errorDiv = document.getElementById('error');
        const infoDiv = document.getElementById('info');
        const tbody = document.querySelector('#playersTable tbody');

        errorDiv.textContent = '';
        infoDiv.textContent = '';
        tbody.innerHTML = '';

        let url = '/players';
        if (query && query.trim() !== "") {
            const encoded = encodeURIComponent(query.trim());
            url += '?q=' + encoded;
        }

        try {
            const resp = await fetch(url);
            if (!resp.ok) {
                throw new Error('Ошибка HTTP: ' + resp.status);
            }
            const data = await resp.json();

            if (data.length === 0) {
                const tr = document.createElement('tr');
                tr.classList.add('empty-row');
                const td = document.createElement('td');
                td.colSpan = 5;
                td.textContent = 'Игроки по заданному условию не найдены';
                tr.appendChild(td);
                tbody.appendChild(tr);

                infoDiv.textContent = query
                    ? 'Фильтр по запросу: "' + query + '"'
                    : 'В базе нет записей.';
                return;
            }

            data.forEach(p => {
                const tr = document.createElement('tr');

                const tdId = document.createElement('td');
                tdId.className = 'col-id';
                tdId.textContent = p.id;

                const tdName = document.createElement('td');
                tdName.className = 'col-name';
                tdName.textContent = p.full_name;

                const tdCity = document.createElement('td');
                tdCity.className = 'col-city';
                tdCity.textContent = p.city;

                const tdHeight = document.createElement('td');
                tdHeight.className = 'col-height';
                tdHeight.textContent = p.height_cm;

                const tdWeight = document.createElement('td');
                tdWeight.className = 'col-weight';
                tdWeight.textContent = p.weight_kg;

                tr.appendChild(tdId);
                tr.appendChild(tdName);
                tr.appendChild(tdCity);
                tr.appendChild(tdHeight);
                tr.appendChild(tdWeight);

                tbody.appendChild(tr);
            });

            infoDiv.textContent = query
                ? 'Найдено записей: ' + data.length + ' (по запросу: "' + query + '")'
                : 'Всего игроков в базе: ' + data.length;
        } catch (e) {
            errorDiv.textContent = 'Ошибка загрузки данных: ' + e.message + '. Введите фамилию или город.';
        }
    }

    document.getElementById('searchBtn').addEventListener('click', () => {
        const q = document.getElementById('searchInput').value;
        loadPlayers(q);
    });

    document.getElementById('resetBtn').addEventListener('click', () => {
        const input = document.getElementById('searchInput');
        input.value = '';
        loadPlayers();
    });

    document.getElementById('searchInput').addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
            e.preventDefault();
            const q = e.target.value;
            loadPlayers(q);
        }
    });

    // Загружаем всех игроков при открытии страницы
    loadPlayers();
</script>
</body>
</html>
